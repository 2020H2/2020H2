# Лабораторная работа №3
Выполнили: 
* сервер – Антропова А.А.
* клиент – Романов А.Л.

## Задание
Разработать клиент-серверную систему регистрации, учета и управления ошибками в программных проектах. Система должна состоять из сервера, хранящего репозиторий ошибок и рабочих клиентских мест, позволяющих программистам и тестерам управлять ошибками, найденными в программных проектах.

## Инструкция по использованию
Вызывается из командной строки:
- сервер – `python3 server.py [ip] [port]`
- клиент – `python3 client.py [ip] [port]`

## Функциональность
#### Сервер:
1) Прослушивание определенного порта
2) Обработка запросов на подключение по этому порту от клиентов
3) Поддержка одновременной работы нескольких клиентов через механизм нитей
4) Регистрация подключившегося клиента в качестве тестера или разработчика
5) Выдача тестеру списка исправленных ошибок
6) Выдача тестеру списка активных (неисправленных) ошибок
7) Прием от тестера новой ошибки с указанием разработчика, проекта,
идентификатора ошибки, текста ошибки
8) Прием от тестера команды о подтверждении или отклонении исправления ошибки
9) Выдача разработчику списка найденных в его проектах ошибок: идентификаторов и текстов
10) Прием команды разработчика об исправлении ошибки
11) Обработка запроса на отключение клиента
12) Принудительное отключение клиента

#### Клиент:
1) Установление соединения с сервером
2) Посылка регистрационных данных клиента (как тестера или как разработчика)
3) Для тестера: получение списка активных ошибок
4) Для тестера: получение списка исправленных ошибок
5) Для тестера: добавление новой ошибки
6) Для тестера: посылка команды подтверждения или отклонения исправления активной ошибки
7) Для разработчика: получение списка активных ошибок
8) Для разработчика: посылка команды исправления активной ошибки 
9) Разрыв соединения
10) Обработка ситуации отключения клиента сервером

## Описание протокола
Сервер и клиент обмениваются пакетами следующего типа:

Header | Body  
------ | -----
message type | content (depends on type)

Разработчики (`dev`) и тестировщики (`test`) идентифицируются по уникальному идентификатору id.

Описание отправляемых пакетов в зависимости от запроса:
#### Запрос на регистрацию `reg`
Формат пакета клиента:
```
type: 100
content: int user_id
         int role_id
```
Ответы сервера:
- Успех
  ```
  type: 101
  content: -
  ```
- Пользователь уже существует
  ```
  type: 102
  content: int user_id
  ```
После регистрации пользователь автоматически авторизуется под заданным `id`.

---
#### Запрос на авторизацию `auth`
Формат пакета клиента:
```
type: 200
content: int user_id
```
Ответы сервера:
- Успех
  ```
  type: 201
  content: int role_id
  ```
 
- Пользователь не найден
  ```
  type: 202
  content: int user_id
  ```
---
#### Запрос на получение списка ошибок `get bugs`
Доступен только для авторизованных пользователей.

Формат пакета клиента:
```
type: 300
content: int status id
```
Доступные статусы:

id | статус
--- | ---
0 | Открыт
1 | Закрыт (исправлен)
2 | Исправлен (ждет подтверждения тестера)

Ответы сервера:
- Список ошибок
  ```
  type: 301
  content: int bugs_num (количество доступных ошибок)
           [
                int bug_id
                int project_id
                int text_length
                char[] text
           ]
  ```
 
- Доступных ошибок нет
  ```
  type: 302
  content: -
  ```

Тестировщику по этой команде выдается список всех ошибок, а для разработчика только те, в которых он указан в поле `dev_id`.

---
#### Запрос на добавление ошибки `add bug`
Доступен только для тестировщика.

Формат пакета клиента:
```
type: 400
content:
         int bug_id
         int dev_id
         int project_id
         int text_length
         char[] text
```

Ответы сервера:
- Успех
  ```
  type: 401
  content: -
  ```
 
- Ошибка с таким `id` уже зарегистрирована
  ```
  type: 402
  content: -
  ```

Ошибка регистрируется на сервере, в поле `test_id` прописывается `id` пользователя, отправившего запрос.

---
#### Запрос на исправление ошибки `fix bug`
Доступен только для разработчиков.

Формат пакета клиента:
```
type: 500
content: int bug_id
```

Ответы сервера:
- Успех
  ```
  type: 501
  content: -
  ```
 
- Задача уже исправлена или закрыта
  ```
  type: 502
  content: -
  ```

- Задача не найдена
  ```
  type: 503
  content: -
  ```
По запросу `status_id` указанной ошибки меняется с `0` (открыта) на `2` (исправлена).  

---
#### Запрос на проверку исправления ошибки `verify bug`
Доступен только для тестировщиков.

Формат пакета клиента:
```
type: 600
content: int bug_id
         int resolution_id
```
`resolution_id` – может быть 0 (не исправлено, открыта) или 1 (исправлено, закрыта).

Ответы сервера:
- Успех
  ```
  type: 601
  content: -
  ```
 
- Задача уже закрыта
  ```
  type: 602
  content: -
  ```
- Задача не существует
  ```
  type: 603
  content: -
  ```
- Задача еще не исправлена 
  ```
  type: 604
  content: -
  ```

- Неизвестная резолюция
  ```
  type: 605
  content: -
  ```
  
По запросу `status_id` указанной ошибки меняется с `2` (исправлена) на `0` (открыта) или `1` (закрыта).  

---
#### Запрос на выход из клиента `quit`
Доступен для всех пользователей.

Формат пакета клиента:
```
type: 700
content: -
```

## Пример использования
```
$ python3 client.py 127.0.0.1 2345   
Register or authorize (reg / auth): reg
Your user_id (unsigned int): 1
Your role (dev / test): test
Success! You are registered and authorize with user_id=1 as test

Command (get bugs / add bug / verify bug / quit): add bug
Bug id: 1
Project id: 1
Developer id: 1
Description: Its description of bug
New bug was added!

Command (get bugs / add bug / verify bug / quit): get bugs
Status of bugs (0-opens, 1-resolved, 2-fixed): 0
1 bugs:
[Bug 1] bug_id=1, project_id=1, text: Its description of bug

Command (get bugs / add bug / verify bug / quit): quit
```